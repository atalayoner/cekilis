<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ã‡ek TulumbayÄ± V2</title>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Roboto', sans-serif;
        text-align: center;
        background: linear-gradient(to bottom, #121212, #222222);
        min-height: 100vh;
        margin: 0;
        padding: 50px 20px;
    }

    h1 {
        color: #333;
        margin-bottom: 40px;
    }

    #btnCekilis {
        padding: 15px 40px;
        font-size: 22px;
        background: linear-gradient(45deg, #ff6b6b, #fbc531);
        border: none;
        border-radius: 12px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    #btnCekilis:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(255, 102, 102, 0.712);
    }

    #btnCekilis:active {
        transform: scale(0.95);
        box-shadow: 0 3px 10px rgba(255, 153, 0, 0.438);
    }

    #btnCekilis:disabled {
        transform: scale(0.95);
        background: linear-gradient(45deg, #532222, #3a2d0b);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0);
    }

    #cekilisGif {
        display: none;
        width: 300px;
        margin-top: 30px;
        position: fixed;      
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
    }

    #sonuc {
        margin-top: 30px;
        font-size: 28px;
        font-weight: bold;
        color: #ff4757;
    }


    #konfetiCanvas {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        width: 100%;
        height: 100%;
        z-index: 9999;
    }
</style>
</head>
<body>

<h1 style="color: white;">ðŸŽ‰ Ã‡ek TulumbayÄ± V2 ðŸŽ‰</h1>
<button id="btnCekilis">Ã‡eeeeek</button>

<div>
    <img id="cekilisGif" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdm53MGtvMGhsYXV3c2ptZm50cGpyMTloOWVsdXkwZjhpb3NybHpxMyZlcD12MV9naWZzX3NlYXJjaCZjdD1n/JSWu7FReUWYvVbOfEs/giphy.gif">
</div>

<div id="sonuc"></div>

<canvas id="konfetiCanvas"></canvas>

<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("btnCekilis");
    const gif = document.getElementById("cekilisGif");
    const sonucDiv = document.getElementById("sonuc");
    const konfetiCanvas = document.getElementById("konfetiCanvas");
    const konfeti = confetti.create(konfetiCanvas, { resize: true, useWorker: true });

    const firebaseConfig = {
        apiKey: "AIzaSyAzVcWvRhmfBmHelaAsnXAqcEF-_O0xjlA",
        authDomain: "cek-tulumbayi.firebaseapp.com",
        databaseURL: "https://cek-tulumbayi-default-rtdb.firebaseio.com/",
        projectId: "cek-tulumbayi",
        storageBucket: "cek-tulumbayi.firebasestorage.app",
        messagingSenderId: "963289261866",
        appId: "1:963289261866:web:5410872ad8a6d1c02a6053"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function cekilisYap(e) {
        e.preventDefault();
        btn.disabled = true;
        sonucDiv.textContent = "";
    
        gif.style.display = "block";
        await new Promise(res => setTimeout(res, 2000));

        try {
            
            const snapshot = await db.ref("/").get();

            if (!snapshot.exists()) {
                sonucDiv.innerText = "Database boÅŸ!";
                return;
            }

            const data = snapshot.val();
            const isimler = Object.values(data);
            const keys = Object.keys(data); 

            const randomIndex = Math.floor(Math.random() * isimler.length);
            const secilenIsim = isimler[randomIndex];
            const firebaseKey = keys[randomIndex]; 

            sonucDiv.innerText = "ðŸŽ‰ Ã‡ekilen KiÅŸi: " + secilenIsim;

            //await db.ref(firebaseKey).remove();

            baslatKonfeti();  
            setTimeout(() => {
                durdurKonfeti();
            }, 5000);

        } catch (err) {
            sonucDiv.innerText = "Al GÄ±rdÄ±n gÄ±rdÄ±n: " + err;
        }
        gif.style.display = "none";
        btn.disabled = true;
    }

    let konfetiInterval;
    function baslatKonfeti() {
        
        if (konfetiInterval) clearInterval(konfetiInterval);

        konfetiInterval = setInterval(() => {
            konfeti({
                particleCount: 300 + Math.floor(Math.random() * 3),
                startVelocity: 60 + Math.random() * 20,
                spread: 120 + Math.random() * 20,
                origin: { x: Math.random(), y: 1 }, 
                gravity: 0.33,
                ticks: 100
            });
        }, 250 + Math.random() * 500);
    }
    function durdurKonfeti() {
        if (konfetiInterval) clearInterval(konfetiInterval);
    }
    btn.addEventListener("click", cekilisYap);
    btn.addEventListener("touchend", cekilisYap, { passive: false });
});
</script>
</body>
</html>
